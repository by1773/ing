<template>
    <div>
        <div class="select" style="margin: 10px 0">
          <v-region @values="regionChange" class="form-control"></v-region>
          <span>KeyWords:{{keywords}}</span>
        </div>
        <div id="map"></div>
    </div>
</template>

<script>
  import Map from 'ol/Map.js'
  import View from 'ol/View.js'
  import {defaults as defaultControls} from 'ol/control.js'
  import TileLayer from 'ol/layer/Tile.js'
  import { mapState } from 'vuex'
  import XYZ from 'ol/source/XYZ.js'
  import GeoJSON from 'ol/format/GeoJSON'
  import {fromLonLat} from 'ol/proj.js';
  import Feature from 'ol/Feature.js';
  import { Vector as VectorLayer} from 'ol/layer.js';
  import {OSM, Vector as VectorSource} from 'ol/source.js';
  import {Circle as CircleStyle, Fill, Stroke, Style} from 'ol/style.js';
  import {LineString, Point, Polygon} from 'ol/geom.js';
  export default {
    name: 'Accessible',
    data(){
      return {
        map: '',
        region:'',
        regions:'',
        keywords:'未选择'
      }
    },
    mounted(){
       this.map = new Map({
        layers: [
          new TileLayer({
           source: new XYZ({
              // 天地图加载
              url: 'http://t4.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}',
              // url:"http://gisserver.tianditu.com/TDTService/wfs",
              wrapX: true,
              // tileUrlFunction: tileUrlFunction
              })
          }),
          new TileLayer({
           source: new XYZ({
              // 天地图加载
              url: 'http://t4.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}',
              // url:"http://gisserver.tianditu.com/TDTService/wfs",
              wrapX: true,
              // tileUrlFunction: tileUrlFunction
              })
          })
        ],
        target: 'map',
        controls: defaultControls({
          attributionOptions: {
            collapsible: false
          }
        }),
        view: new View({
          center:  fromLonLat([106, 26]),
          zoom:10,
          // minZoom:4,
          // maxZoom:10,
        })
      });
    },
    computed:{...mapState(['count'])},
    methods: {
      //===========请求=============
      regionChange(d) {
        this.region = (!d.province&&!d.city&&!d.area&&!d.town)?'please select': `${this.getValue(d.province)}${this.getValue(d.city)}${this.getValue(d.area)}${this.getValue(d.town)}`.trim();
        this.keywords = this.region
        this.getData(this.region)
      },
      getValue(obj){
        return obj?obj.value:'';
      },
      getData(data){
        console.log(data)
        this.axios.get(
          'http://api.tianditu.gov.cn/administrative',
          {
            params:{
              postStr:{
                searchWord: data,
                searchType:'1',
                needSubInfo:'false',
                needAll:'false',
                needPolygon:'true',
                needPre:'true'
              },
              tk:'5fc85d4954c383955d0627f173746e67'
            }
          })
        .then((response)=>{
          let res = response.data.data[0].points;
          console.log(res)
          this.drawLayers(res)
        })
        .catch((error)=>{
          console.log(error);
        });
      },
      //======绘制边界==========================
      drawLayers(reg){
        let v =[[[[106.72053058252,26.676756677079],[106.720381913794,26.6702131999792],[106.720355229111,26.6690230147004],[106.719737680849,26.6609663733994],[106.719360289346,26.6584385005364],[106.71852164276,26.6565108073279],[106.717778296431,26.6554910112013],[106.716619439036,26.6551629475121],[106.714560942134,26.6558877399273],[106.713615557712,26.6567015418427],[106.712136489507,26.6572177976633],[106.710905203412,26.6566862830456],[106.710211414225,26.6558241614559],[106.710192353994,26.6556461424556],[106.710150421305,26.6553994584183],[106.710024624137,26.6545373368287],[106.710584992603,26.6504835860487],[106.712269911128,26.6453057699454],[106.712491008553,26.6446318395878],[106.712582497484,26.644481794899],[106.714316971351,26.6416640057893],[106.719661439924,26.6373762855872],[106.722299365523,26.6355706627559],[106.723442974913,26.6339862911345],[106.723782245954,26.6325036454269],[106.723923291127,26.6309879397417],[106.724586584303,26.6286024817192],[106.726275314154,26.627058800823],[106.730247451459,26.6254083092461],[106.733594414251,26.6231194905721],[106.734299640116,26.6219674518365],[106.734364445263,26.6218657268219],[106.734417813731,26.6217792606045],[106.734486430205,26.6216699057416],[106.73526408477,26.6204237709403],[106.737562739329,26.6129698525767],[106.738431882825,26.610454695228],[106.739872830567,26.6083947594107],[106.742262974057,26.606929915783],[106.745617562201,26.6065128416943],[106.746231299135,26.6066349120716],[106.748735803115,26.6071282792468],[106.748945465661,26.6071715132548],[106.749757427563,26.607334273458],[106.753741000647,26.60895424834],[106.754568211454,26.6090712321517],[106.754724504632,26.6091119219777],[106.754819805789,26.6091475261375],[106.7549227305,26.6091983890944],[106.755018031657,26.6092619666665],[106.756817309771,26.6109048301938],[106.760583597655,26.6133538657883],[106.760747514386,26.6134555908029],[106.762184650801,26.6143914630956],[106.762630657879,26.6146839235243],[106.762821259294,26.6147602175101],[106.762966116693,26.6148187094159],[106.765402005099,26.6157927282518],[106.765695531224,26.6158334189772],[106.766408381542,26.6159198851946],[106.766736215904,26.6159707481515],[106.768081863387,26.6158435912088],[106.769682916533,26.6154748367943],[106.769984067111,26.6154087159396],[106.771634676499,26.6146203450529],[106.775488640189,26.6119780316609],[106.778442964371,26.608895756434],[106.778988084832,26.6070977616524],[106.778420091914,26.6052794233068],[106.776921964377,26.6035017738878],[106.771859755224,26.5983388793359],[106.771192748746,26.5973443154878],[106.770926057492,26.5958308500138],[106.770884268694,26.5943987812788],[106.770880468159,26.5942843173674],[106.770827293045,26.5923435201374],[106.770815904031,26.5918754904616],[106.770747613112,26.5886069134783],[106.770061575182,26.5873274623925],[106.769398326971,26.5868772383939],[106.768891361147,26.586531303377],[106.765574996889,26.5855062165387],[106.758191183376,26.584590506147],[106.750365173214,26.5836773399374],[106.74959896522,26.5835781375211],[106.746267291802,26.5831533499472],[106.746232984465,26.5831482624824],[106.746042385748,26.5831228260576],[106.741727229028,26.5824869163382],[106.741338416135,26.5823419285372],[106.740434966201,26.5823342977897],[106.74035491125,26.5823495592848],[106.739230362092,26.5823521034669],[106.737919033637,26.5822478135858],[106.735387821591,26.5824818288734],[106.732791779217,26.5829702075091],[106.729566802266,26.582954946014],[106.728350821733,26.5823826264571],[106.727718016473,26.5824563924486],[106.727500731274,26.5824538491659],[106.727195775665,26.5823851706392],[106.726982296396,26.5824385867714],[106.72685267621,26.5825530506828],[106.726696349757,26.5828862674873],[106.726459989937,26.5830261678234],[106.726227455832,26.5830210803586],[106.725987308967,26.582911703912],[106.725781488325,26.5826191850274],[106.725411723972,26.5825912053199],[106.724885669138,26.5825428757532],[106.724626466538,26.5823851706392],[106.72429105269,26.5819374899233],[106.724054749527,26.5815076148846],[106.723871812134,26.5811006320886],[106.723723157798,26.5809505577221],[106.723494440416,26.5809073156202],[106.723361029588,26.5808081141032],[106.723242865866,26.580708911687],[106.722747366398,26.5800704586848],[106.722484372256,26.5797092612734],[106.722232837276,26.5791165936559],[106.722328150124,26.5789919548149],[106.722244285645,26.578994498997],[106.722175669172,26.5789919548149],[106.722103240472,26.578994498997],[106.721958383073,26.5789970422798],[106.721805880537,26.5792081644253],[106.721584748038,26.5795540994422],[106.721237806679,26.5800195858353],[106.720848927236,26.5805461191081],[106.720665921495,26.5808284630632],[106.720330406923,26.5813804327608],[106.71954894193,26.5813677145484],[106.718946640775,26.581375345296],[106.717997442328,26.5813931509732],[106.717551434351,26.5814033259028],[106.715813144661,26.5814363930751],[106.715683535267,26.5814414805399],[106.715317580442,26.5814389363579],[106.71486775934,26.5814516545702],[106.714330260633,26.5814694602474],[106.714284516617,26.5814720035302],[106.714120598087,26.581477090995],[106.713994803617,26.5814541987523],[106.713495436165,26.5813702578312],[106.712870276942,26.5812303583944],[106.711353122449,26.5808869666602],[106.711254011763,26.5808640735182],[106.710869001203,26.5808233755984],[106.710541166841,26.5808157448508],[106.710060847031,26.5808589869528],[106.709580521824,26.5809480144393],[106.709252678468,26.5810319544612],[106.70898964026,26.581115894483],[106.708760911187,26.5811896595752],[106.708612237964,26.5812252709296],[106.708375888936,26.5812557948191],[106.708219593959,26.5812710563142],[106.708097608118,26.5812786870618],[106.708040428323,26.5812761437791],[106.707975624975,26.5812659688494],[106.707914632954,26.5812583381019],[106.707865077611,26.5812481631722],[106.707685918271,26.5811896595752],[106.707522006036,26.5811362434429],[106.707228489803,26.5810370410267],[106.706957842431,26.5809632759345],[106.706828235735,26.5809378395097],[106.706599517454,26.5809022281554],[106.706206879744,26.5808945974078],[106.706168759281,26.5808920541251],[106.705326300468,26.5808869666602],[106.704762120675,26.5808818791954],[106.704415226082,26.5808793359127],[106.704068332388,26.5808640735182],[106.703450786824,26.5808284630632],[106.703370739968,26.5807699594661],[106.703313562871,26.5807445230413],[106.703248759523,26.5807292606469],[106.702253829651,26.5806249716651],[106.702089913819,26.580607165988],[106.702116605697,26.5805334008958],[106.70230726287,26.5799788870161],[106.702402596403,26.5796482143936],[106.702436925324,26.5794421797129],[106.702436940612,26.5792895611644],[106.702410275714,26.5790911572312],[106.702341679025,26.5788978407628],[106.702021524874,26.578328065388],[106.702010090893,26.578307716428],[106.70191861725,26.5781550978795],[106.70190718327,26.5781322047375],[106.701777597258,26.5779032769148],[106.701461249937,26.577394549319],[106.701438382875,26.5773385890047],[106.701411706285,26.5772673671953],[106.70139265145,26.5772088635982],[106.701373597514,26.5771478167184],[106.701221115662,26.5771503600012],[106.700858973063,26.5771503600012],[106.700382469076,26.5771503600012],[106.700161370751,26.5771529032839],[106.699765238275,26.5771583055114],[106.699300857149,26.5771691585299],[106.699053443761,26.5771644334919],[106.698634748195,26.5771421572848],[106.698478687941,26.5771372991471],[106.69825792956,26.5770435097502],[106.698143743539,26.5770004358215],[106.697968660825,26.576914209723],[106.697877313088,26.5768634717718],[106.697804997703,26.5768177925071],[106.697759325632,26.5767746178544],[106.697725072254,26.5767416010441],[106.697690818876,26.576703496769],[106.697489112633,26.5764036439131],[106.697249349778,26.5760427999353],[106.697237932884,26.5760224671632],[106.696937279632,26.5755472483069],[106.696674682091,26.5751431946028],[106.696583343347,26.5750161473774],[106.696126646028,26.5743859942183],[106.696001029624,26.5744599454702],[106.695962962221,26.5745007000473],[106.695928696252,26.5745846913305],[106.69571934757,26.5745900863635],[106.694638358873,26.5745001082934],[106.694508942834,26.5745053855152],[106.694375720863,26.5745106699315],[106.694322431535,26.5745158356373],[106.69370580328,26.5745447236601],[106.693584000901,26.5745423602418],[106.693363234426,26.5745375974323],[106.692700931403,26.5745436606614],[106.692084306745,26.5745369382292],[106.691878764893,26.5745397845835],[106.691783607627,26.5745297508474],[106.691330657784,26.5744922626079],[106.691254531971,26.5744847442756],[106.691102279447,26.5744773374592],[106.690984283898,26.574464792816],[106.690889127531,26.5744522148979],[106.690790164335,26.5744345549109],[106.690717845352,26.5744193995357],[106.690478053719,26.5743459869778],[106.690261103067,26.5742445596388],[106.689804373373,26.5739399925367],[106.689275318401,26.5736889485862],[106.689008869963,26.5737427586214],[106.688791890533,26.5739313095823],[106.688559663997,26.5743310069705],[106.688281787874,26.5744713182967],[106.687977288221,26.5744107192793],[106.687140005907,26.5732978244351],[106.686835503556,26.5732524860135],[106.686580472011,26.5733266279216],[106.68625692112,26.5734542884847],[106.685952402581,26.5735742895219],[106.685419502108,26.5737200633303],[106.685099753551,26.5738833298519],[106.684905621397,26.5739802758691],[106.68421663459,26.5743908226784],[106.683436256878,26.5751856012346],[106.682400860212,26.5759375145047],[106.68160903323,26.5770400986217],[106.680718336582,26.5771965779597],[106.680101696636,26.5773399343905],[106.67870857574,26.5773725159289],[106.678472589139,26.5773092720053],[106.677932104683,26.5771676224878],[106.675994846285,26.5755196202343],[106.67537446516,26.5750067071938],[106.674065227628,26.5735994237745],[106.672169842564,26.5719131913407],[106.671222147784,26.5710904222852],[106.670396237397,26.5704607952296],[106.669616009871,26.5697547878532],[106.668740604395,26.5692396984534],[106.667891847631,26.5686864130476],[106.667161056737,26.568443288527],[106.666133369959,26.5682133174907],[106.665558613239,26.5682192485195],[106.665368296909,26.5682195273094],[106.663746798576,26.5682295376631],[106.660899669085,26.5681624896072],[106.656377683583,26.5688076056865],[106.653758936925,26.5687147866581],[106.653614301659,26.5686590358858],[106.652236450352,26.5682515125973],[106.650930783129,26.5692073399468],[106.646522729141,26.572446949767],[106.646956518029,26.573774162048],[106.646994571043,26.5738809448497],[106.64750446416,26.5754395266129],[106.648539582036,26.5774857360779],[106.650061887846,26.5797576151219],[106.651496679728,26.5817218226041],[106.651473816264,26.581976232717],[106.651409097452,26.5820882540697],[106.652801899088,26.585253172496],[106.652706571851,26.5869474574592],[106.654833989197,26.5901748652778],[106.657589413021,26.5937879707383],[106.658301096918,26.5947942320682],[106.65844569891,26.5951781211734],[106.658506565026,26.5955341546775],[106.658331396877,26.5963051713466],[106.658327575657,26.5964552583036],[106.65847981739,26.5965694991831],[106.66036756631,26.5984846558422],[106.660439882595,26.5985303351069],[106.660576901503,26.5986166169633],[106.665452671304,26.6016766654458],[106.666160649095,26.602168971421],[106.666845788602,26.6026384247236],[106.667032299001,26.6027754742088],[106.674983725019,26.6083253875067],[106.679791121163,26.6138367783447],[106.681915054536,26.6169362162335],[106.682021631393,26.6170861008429],[106.685085728624,26.621587937933],[106.685561519449,26.6223196470341],[106.68614769486,26.6232571839719],[106.686220014742,26.6233715165823],[106.686318979737,26.6235315860139],[106.686726257511,26.6242557677895],[106.687118308863,26.6251808805932],[106.687198242405,26.6257275334989],[106.687167791361,26.6266405639109],[106.686924186602,26.6277268460172],[106.686771933178,26.6285841094691],[106.686513102897,26.6298916670668],[106.686189564597,26.6316265672124],[106.68525320667,26.6383596393859],[106.688039441267,26.6395125891347],[106.690589683867,26.6405946848968],[106.693623329153,26.6422940366405],[106.695012640521,26.6431133864737],[106.695537913844,26.6434508354877],[106.696173571753,26.6437677745632],[106.697014771515,26.6443260035423],[106.697315472431,26.6446358154905],[106.697482951377,26.6448873351824],[106.698103383764,26.646163057679],[106.698609628332,26.6471668386787],[106.698807558322,26.6476471944625],[106.699401350992,26.6489687374174],[106.700117154683,26.6506310874548],[106.700246764077,26.6511371701444],[106.700704207833,26.6526223591346],[106.701775388523,26.6562158036165],[106.70180969676,26.6563429605592],[106.701824944765,26.6564141679795],[106.702183276037,26.6578840981726],[106.702187087364,26.6581562132387],[106.702114658665,26.6592548466339],[106.702076539101,26.6598829997007],[106.702270952742,26.6604246865501],[106.702472989937,26.6608086997617],[106.703704276032,26.6621972494036],[106.704428562128,26.6634204955595],[106.704825013863,26.6642444706059],[106.705114727763,26.6650430137241],[106.705103291983,26.6656965987191],[106.704847885422,26.6666273844463],[106.704600103312,26.6672021321727],[106.704420938576,26.6679676144139],[106.704196028024,26.6692010337008],[106.704005426609,26.6702131999792],[106.704077855309,26.6712507972865],[106.704581043081,26.6734455198949],[106.705492119266,26.6754952843799],[106.706788209608,26.6771483192396],[106.708221533797,26.6782367795038],[106.709494751682,26.6789844605644],[106.710992880117,26.6795083453339],[106.712799783583,26.679864384234],[106.712856963378,26.6798592976685],[106.715014573664,26.6796177001967],[106.717294167991,26.6787352332445],[106.72053058252,26.676756677079]]]]
          let GeoJSON_data =  {
              'type': 'Feature',
              'geometry': {
                'type': 'MultiPolygon',
                'coordinates': v
              }
            }
            console.log(GeoJSON_data)
          let vectorSource = new VectorSource({
            features: (new GeoJSON()).readFeatures(GeoJSON_data)
          });

          const lineFeature = new Feature(
               new LineString([[4e6, 2e6], [8e6, -2e6]]));
          const polygonFeature = new Feature(
            new Polygon([[[-5e6, -1e6], [-4e6, 1e6], [-3e6, -1e6]]]));
          let vectorLayer = new VectorLayer({
            // projection: 'EPSG:3857',
            // source: feature,
             features: [lineFeature,polygonFeature],
            style: new Style({
                
        stroke: new Stroke({
          width: 10,
          color: 'red',
          lineDash: [4],
        }),
        fill: new Fill({
          color: 'red'
        })
                }),
          });

       
        this.map.addLayer(vectorLayer)
        console.log(this.map.getLayers())
      },
      alerts(){
        alert('333')
      }
    }
    
  }
</script>
